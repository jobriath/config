# LET THERE BE VIM
set -o vi

alias ll='ls -l'

# Use ripgrep `rg` instead, though.
alias rep='grep -rI --exclude-dir "node_modules" --exclude-dir ".stack-work*" --exclude "tags" --exclude-dir ".hg" --exclude-dir ".git" --exclude-dir "build" --exclude-dir "out" --exclude-dir ".idea"'

alias rgg="rg -g'!*test*' -g'!*node_modules*' -g'!*spec*' -g'!*extracted_queries*'"
alias rgt="rg -g'*test*' -g'!*node_modules*' -g'!*spec*' -g'!*extracted_queries*'"

alias splitxml="perl -pe 'BEGIN{ $/=\">\" } s/>/>\n/g'"  # PERL'S $/ variable defines what line-end is, so \n isn't everything anymore!

# There's more to less. This makes psql not such a bind to use.
export PAGER=less
export LESS='-r -C -M -j10 -#4'
# -r:   show colours
# -C:   start from top
# -M:   give more info
# -j10: give more context around search hits
# -#4:  move 4 rows/columns instead of half-page

export EDITOR=vim

# FZF engine replacement.
if type rg &> /dev/null; then
    export FZF_DEFAULT_COMMAND="rg --files --hidden -g !'.git/' -g '!node_modules/'"
elif type ag &> /dev/null; then
    export FZF_DEFAULT_COMMAND='ag -p ~/.gitignore -g ""'
fi

# Stack helpers
alias stack-build='stack build --work-dir=.stack-work '
alias stack-build-fast='stack build --fast --work-dir=.stack-work-fast'
alias stack-build-profile='stack build --profile --work-dir=.stack-work-profile '
alias stack-build-optimised='stack build --work-dir=.stack-work-optimised --ghc-options -O2'
alias stack-clean='stack clean --work-dir=.stack-work '
alias stack-clean-fast='stack clean --work-dir=.stack-work-fast '
alias stack-clean-profile='stack clean --work-dir=.stack-work-profile '
alias stack-clean-optimised='stack clean --work-dir=.stack-work-optimised '
alias stack-clean-pedantic='stack clean --work-dir=.stack-work-pedantic '
alias stack-exec='stack exec --work-dir=.stack-work '
alias stack-exec-fast='stack exec --work-dir=.stack-work-fast '
alias stack-exec-profile='stack exec --work-dir=.stack-work-profile --rts-options -p'
alias stack-exec-optimised='stack exec --work-dir=.stack-work-optimised '
alias stack-install='stack install --work-dir=.stack-work '
alias stack-install-fast='stack install --work-dir=.stack-work-fast --fast '
alias stack-install-profile='stack install --work-dir=.stack-work-profile '
alias stack-install-optimised='stack install --work-dir=.stack-work-optimised '

setSshProfile() {
  profile=$1
  if [ -z $profile ]; then
    echo "Usage: setSshProfile <profile|rsa>"
    echo "  Makes only id_<profile> the SSH key registered with ssh-add"
    echo "Defaulting to rsa"
    echo ""
    profile="rsa"
  fi

  ssh-add -D
  ssh-add "$HOME/.ssh/id_$profile"

  # Switching keys may still leave a socket tied to a different account, so delete socket.
  rm "$HOME/.ssh/sockets/git@ssh.github.com-443" 2>/dev/null
  echo "Cleared open sockets"
}

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

isgitrepo()
{
  if git rev-parse  --git-dir 2>&1 > /dev/null ; then
    return 0
  else
    return 1
  fi
}

test -f ~/.git-completion.bash && source $_

# ls et al. should be in colour!
export CLICOLOR=1

# bash-completion config
export BASH_COMPLETION_COMPAT_DIR="/usr/local/etc/bash_completion.d"
[[ -r "/usr/local/etc/profile.d/bash_completion.sh" ]] && . "/usr/local/etc/profile.d/bash_completion.sh"

[ -s "$HOME/.thismachinerc" ] && source "$HOME/.thismachinerc"

# Kubernetes
function kns() {
  newNamespace="$1"
  if [ -z "$newNamespace" ]
  then
    kubectl config get-contexts
  else
    kubectl config set-context --current --namespace="$newNamespace"
  fi
}

# Something to beep from the commandline
function bell() {
  tput bel && tput bel && tput bel && tput bel
}

# PYTHONPATH isn't set on my mac.
# Here are the defaults it reported before replacing them with brew-enabled equivalents: ['/Users/aha03/workspace/betfair-mps', '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python37.zip', '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7', '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/lib-dynload', '/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.7/lib/python3.7/site-packages']
PYTHONPATH="$PYTHONPATH:/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python37.zip:/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7:/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/lib/python3.7/lib-dynload:/usr/local/lib/python3.7/site-packages"

[ -s "/opt/homebrew/opt/asdf/libexec/asdf.sh" ] && . /opt/homebrew/opt/asdf/libexec/asdf.sh

[ -s "/opt/homebrew/opt/asdf/etc/bash_completion.d/asdf.bash" ] && . /opt/homebrew/opt/asdf/etc/bash_completion.d/asdf.bash

export PATH=$PATH:~/bin
